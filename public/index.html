<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบ POS ร้านเครื่องดื่ม</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
            padding: 0 20px;
        }

        .nav-tab {
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            color: #333;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .nav-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* สไตล์ปุ่มลบ */
        .btn-delete {
            background-color: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .btn-delete:hover {
            background-color: #cc0000;
            transform: translateY(-1px);
        }

        .btn-delete i {
            font-size: 0.8rem;
        }

        /* ไอคอน Font Awesome */
        @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css');

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .stat-value {
            font-size: 3rem;
            font-weight: bold;
            margin: 15px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: #666;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .product-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #56ccf2 0%, #2f80ed 100%);
        }

        .product-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .product-name {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .product-category {
            color: #666;
            font-size: 1rem;
            margin-bottom: 15px;
            padding: 5px 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 20px;
            display: inline-block;
        }

        .product-price {
            font-size: 2rem;
            font-weight: bold;
            margin: 15px 0;
            background: linear-gradient(135deg, #56ccf2 0%, #2f80ed 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .product-stock {
            color: #666;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ccf2 0%, #2f80ed 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(86, 204, 242, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #feca57 0%, #ff9f43 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(254, 202, 87, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .cart {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            position: sticky;
            top: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .cart h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.5rem;
            text-align: center;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .quantity-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 1.1rem;
        }

        .form-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 15px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
            background: white;
        }

        .table-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 20px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .alert {
            padding: 20px 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-weight: 500;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .alert-success {
            background: rgba(40, 167, 69, 0.1);
            color: #155724;
        }

        .alert-success::before {
            background: #28a745;
        }

        .alert-danger {
            background: rgba(220, 53, 69, 0.1);
            color: #721c24;
        }

        .alert-danger::before {
            background: #dc3545;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            margin: 5% auto;
            padding: 40px;
            border-radius: 25px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #667eea;
        }

        .loading {
            display: inline-block;
            width: 25px;
            height: 25px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .empty-state {
            text-align: center;
            color: #666;
            padding: 60px 20px;
            font-size: 1.1rem;
        }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            text-align: center;
            display: inline-block;
        }

        .status-low {
            background: rgba(255, 107, 107, 0.2);
            color: #dc3545;
        }

        .status-medium {
            background: rgba(254, 202, 87, 0.2);
            color: #fd7e14;
        }

        .status-good {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .nav-tabs {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 10px;
            }

            .nav-tab {
                white-space: nowrap;
                flex-shrink: 0;
                padding: 12px 20px;
                font-size: 14px;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .stat-value {
                font-size: 2rem;
            }

            .table th,
            .table td {
                padding: 12px 8px;
                font-size: 14px;
            }

            .modal-content {
                margin: 10% auto;
                padding: 25px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>🥤 ระบบ POS ร้านเครื่องดื่ม</h1>
            <p style="font-size: 1.2rem; color: #666; margin-top: 10px;">
                วันที่: <span id="currentDate"></span>
            </p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">📊 แดชบอร์ด</button>
            <button class="nav-tab" onclick="showTab('sales')">🛒 ขายสินค้า</button>
            <button class="nav-tab" onclick="showTab('products')">📦 จัดการสินค้า</button>
            <button class="nav-tab" onclick="showTab('materials')">🥤 วัตถุดิบ</button>
            <button class="nav-tab" onclick="showTab('reports')">📈 รายงาน</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">💰 รายได้วันนี้</div>
                    <div class="stat-value" id="todayRevenue">฿0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">📈 กำไรวันนี้</div>
                    <div class="stat-value" id="todayProfit">฿0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">🥤 แก้วที่ขายวันนี้</div>
                    <div class="stat-value" id="todayQuantity">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">💵 รายได้เดือนนี้</div>
                    <div class="stat-value" id="monthRevenue">฿0</div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 20px; font-size: 1.5rem;">📊 ยอดขายรายวัน (7 วันย้อนหลัง)</h3>
                <div class="chart-container">
                    <canvas id="salesChart" width="400" height="300"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 20px; font-size: 1.5rem;">🏆 เมนูขายดี TOP 5</h3>
                <div id="bestSelling"></div>
            </div>

            <div class="card" id="lowStockAlert" style="display: none;">
                <h3 style="margin-bottom: 20px; font-size: 1.5rem; color: #dc3545;">⚠️ แจ้งเตือนวัตถุดิบใกล้หมด</h3>
                <div id="lowStockList"></div>
            </div>
        </div>

        <!-- Sales Tab -->
        <div id="sales" class="tab-content">
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
                <div>
                    <div class="card">
                        <h3 style="margin-bottom: 25px; font-size: 1.5rem;">🛍️ รายการสินค้า</h3>
                        <div class="products-grid" id="productsList">
                            <!-- Products will be loaded here -->
                        </div>
                    </div>
                </div>

                <div class="cart">
                    <h3>🛒 ตะกร้าสินค้า</h3>
                    <div id="cartItems">
                        <div class="empty-state">
                            <div class="icon">🛒</div>
                            <p>ไม่มีสินค้าในตะกร้า</p>
                        </div>
                    </div>
                    <div id="cartSummary" style="display: none;">
                        <hr style="margin: 25px 0; border: none; height: 1px; background: rgba(0,0,0,0.1);">
                        <div
                            style="display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 1.1rem;">
                            <strong>ยอดรวม:</strong>
                            <strong id="cartTotal" style="color: #28a745;">฿0</strong>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; margin-bottom: 25px; font-size: 1.1rem;">
                            <strong>กำไร:</strong>
                            <strong style="color: #007bff;" id="cartProfit">฿0</strong>
                        </div>

                        <!-- ✅ ปุ่มบันทึกการขายพร้อมการยืนยัน -->
                        <button class="btn btn-success" style="width: 100%; font-size: 1.1rem;"
                            onclick="confirmPaymentBeforeSale()">
                            💳 บันทึกการขาย
                        </button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 25px; font-size: 1.5rem;">📝 ประวัติการขายล่าสุด</h3>
                <div id="recentSales"></div>
            </div>
        </div>

        <!-- ✅ SweetAlert2 CDN -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <!-- ✅ JavaScript -->
        <script>
            function confirmPaymentBeforeSale() {
                Swal.fire({
                    title: 'ยืนยันการโอนเงิน?',
                    text: "คุณแน่ใจหรือไม่ว่าลูกค้าได้โอนเงินแล้ว?",
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'ยืนยัน',
                    cancelButtonText: 'ยกเลิก',
                    reverseButtons: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        processSale();
                    }
                });
            }

            function processSale() {
                // ตัวอย่างการบันทึกการขาย
                // คุณสามารถเพิ่มโค้ดจริงสำหรับบันทึกลง database ได้ที่นี่

                Swal.fire({
                    icon: 'success',
                    title: 'บันทึกสำเร็จ',
                    text: 'การขายถูกบันทึกเรียบร้อยแล้ว',
                    confirmButtonText: 'ตกลง'
                });

                // ✅ ตัวอย่าง: ล้างตะกร้า
                document.getElementById("cartItems").innerHTML = `
            <div class="empty-state">
                <div class="icon">🛒</div>
                <p>ไม่มีสินค้าในตะกร้า</p>
            </div>`;
                document.getElementById("cartSummary").style.display = "none";
                document.getElementById("cartTotal").innerText = "฿0";
                document.getElementById("cartProfit").innerText = "฿0";

                // ✅ TODO: เพิ่มโค้ดอัปเดต recentSales หรือบันทึกลงฐานข้อมูลที่นี่
            }
        </script>



    </div>

    <!-- Products Tab -->
    <div id="products" class="tab-content">
        <div class="card">
            <div
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                <h3 style="font-size: 1.5rem;">📦 จัดการสินค้า</h3>
                <button class="btn btn-primary" onclick="showAddProductModal()">➕ เพิ่มสินค้าใหม่</button>
            </div>
            <div class="table-container" id="productsTable"></div>
        </div>
    </div>

    <!-- Materials Tab -->
    <div id="materials" class="tab-content">
        <div class="card">
            <div
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                <h3 style="font-size: 1.5rem;">🥤 จัดการวัตถุดิบ</h3>
                <button class="btn btn-primary" onclick="showAddMaterialModal()">➕ เพิ่มวัตถุดิบใหม่</button>
            </div>
            <div class="table-container" id="materialsTable"></div>
        </div>
    </div>

    <!-- Reports Tab -->
    <div id="reports" class="tab-content">
        <div class="card">
            <h3 style="margin-bottom: 25px; font-size: 1.5rem;">📊 รายงานสรุปผล</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">💰 รายได้รวมทั้งหมด</div>
                    <div class="stat-value" id="totalRevenue">฿0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">📈 กำไรรวมทั้งหมด</div>
                    <div class="stat-value" id="totalProfit">฿0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">🥤 แก้วที่ขายทั้งหมด</div>
                    <div class="stat-value" id="totalQuantity">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">📊 อัตรากำไร</div>
                    <div class="stat-value" id="profitMargin">0%</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-bottom: 25px; font-size: 1.5rem;">📈 รายงานสินค้า</h3>
            <div class="table-container" id="productReports"></div>
        </div>
    </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addProductModal')">&times;</span>
            <h3 style="margin-bottom: 25px; font-size: 1.5rem;">➕ เพิ่มสินค้าใหม่</h3>
            <form id="addProductForm" onsubmit="addProduct(event)">
                <div class="form-group">
                    <label class="form-label">ชื่อสินค้า:</label>
                    <input type="text" class="form-input" name="name" required placeholder="เช่น ชาไทย, กาแฟเย็น">
                </div>
                <div class="form-group">
                    <label class="form-label">ราคาขาย (บาท):</label>
                    <input type="number" class="form-input" name="price" required placeholder="25" min="1">
                </div>
                <div class="form-group">
                    <label class="form-label">ต้นทุน (บาท):</label>
                    <input type="number" class="form-input" name="cost" required placeholder="12" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">จำนวนสต็อก:</label>
                    <input type="number" class="form-input" name="stock" required placeholder="50" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">หมวดหมู่:</label>
                    <input type="text" class="form-input" name="category" required
                        placeholder="เช่น ชา, กาแฟ, น้ำผลไม้">
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%; font-size: 1.1rem;">
                    💾 บันทึกสินค้า
                </button>
            </form>
        </div>
    </div>

    <!-- Add Material Modal -->
    <div id="addMaterialModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addMaterialModal')">&times;</span>
            <h3 style="margin-bottom: 25px; font-size: 1.5rem;">➕ เพิ่มวัตถุดิบใหม่</h3>
            <form id="addMaterialForm" onsubmit="addMaterial(event)">
                <div class="form-group">
                    <label class="form-label">ชื่อวัตถุดิบ:</label>
                    <input type="text" class="form-input" name="name" required placeholder="เช่น น้ำ, น้ำแข็ง">
                </div>
                <div class="form-group">
                    <label class="form-label">หน่วย:</label>
                    <input type="text" class="form-input" name="unit" required placeholder="เช่น ลิตร, กิโลกรัม, ใบ">
                </div>
                <div class="form-group">
                    <label class="form-label">จำนวนสต็อก:</label>
                    <input type="number" class="form-input" name="stock" required placeholder="100" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">ต้นทุนต่อหน่วย (บาท):</label>
                    <input type="number" class="form-input" name="cost" step="0.01" required placeholder="2.50" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">สต็อกขั้นต่ำ:</label>
                    <input type="number" class="form-input" name="minStock" required placeholder="20" min="1">
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%; font-size: 1.1rem;">
                    💾 บันทึกวัตถุดิบ
                </button>
            </form>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div id="editProductModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editProductModal')">&times;</span>
            <h3 style="margin-bottom: 25px; font-size: 1.5rem;">✏️ แก้ไขสินค้า</h3>
            <form id="editProductForm" onsubmit="updateProduct(event)">
                <input type="hidden" name="id">
                <div class="form-group">
                    <label class="form-label">ชื่อสินค้า:</label>
                    <input type="text" class="form-input" name="name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ราคาขาย (บาท):</label>
                    <input type="number" class="form-input" name="price" required min="1">
                </div>
                <div class="form-group">
                    <label class="form-label">ต้นทุน (บาท):</label>
                    <input type="number" class="form-input" name="cost" required min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">จำนวนสต็อก:</label>
                    <input type="number" class="form-input" name="stock" required min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">หมวดหมู่:</label>
                    <input type="text" class="form-input" name="category" required>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%; font-size: 1.1rem;">
                    💾 อัปเดตสินค้า
                </button>
            </form>
        </div>
    </div>

    <script>
        // Google Sheets Configuration
        const GOOGLE_SHEETS_URL = 'https://docs.google.com/spreadsheets/d/1H83uZSGkKSe5vNeRufTx8DC4U_t4a0qJIFG27e4vnEM/edit?gid=0#gid=0';

        // Sample data
        let products = [
            { id: 1, name: 'ชาไทย', price: 25, cost: 12, stock: 50, category: 'ชา' },
            { id: 2, name: 'กาแฟเย็น', price: 30, cost: 15, stock: 40, category: 'กาแฟ' },
            { id: 3, name: 'น้ำส้มคั้น', price: 35, cost: 18, stock: 30, category: 'น้ำผลไม้' },
            { id: 4, name: 'โกโก้เย็น', price: 28, cost: 14, stock: 35, category: 'โกโก้' },
            { id: 5, name: 'น้ำเปล่า', price: 10, cost: 5, stock: 100, category: 'น้ำ' },
            { id: 6, name: 'ชาเขียว', price: 25, cost: 13, stock: 45, category: 'ชา' },
            { id: 7, name: 'น้ำมะนาว', price: 20, cost: 8, stock: 60, category: 'น้ำผลไม้' }
        ];

        let materials = [
            { id: 1, name: 'น้ำ', unit: 'ลิตร', stock: 500, cost: 2, minStock: 50 },
            { id: 2, name: 'น้ำแข็ง', unit: 'กิโลกรัม', stock: 20, cost: 10, minStock: 5 },
            { id: 3, name: 'แก้วพลาสติก', unit: 'ใบ', stock: 200, cost: 1.5, minStock: 50 },
            { id: 4, name: 'ฝาแก้ว', unit: 'ใบ', stock: 180, cost: 0.5, minStock: 40 },
            { id: 5, name: 'หลอดดูด', unit: 'อัน', stock: 150, cost: 0.3, minStock: 30 },
            { id: 6, name: 'น้ำตาล', unit: 'กิโลกรัม', stock: 25, cost: 25, minStock: 5 },
            { id: 7, name: 'นม', unit: 'ลิตร', stock: 15, cost: 35, minStock: 5 }
        ];

        let sales = [];
        let cart = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            updateCurrentDate();
            loadData();
            updateDashboard();
            renderProducts();
            renderProductsTable();
            renderMaterialsTable();
            updateRecentSales();
            updateLowStockAlert();
        });

        function updateCurrentDate() {
            const now = new Date();
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('th-TH', options);
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked nav tab
            event.target.classList.add('active');

            // Update data when switching tabs
            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'reports') {
                updateReports();
            }
        }

        async function saveToGoogleSheets(saleData) {
            try {
                // ในการใช้งานจริง จะต้องสร้าง Google Apps Script Web App
                // และใช้ URL ของ Web App ที่สร้างขึ้น
                console.log('บันทึกข้อมูลไปยัง Google Sheets:', saleData);

                // สำหรับการใช้งานจริง ให้แทนที่ด้วย URL ของ Google Apps Script
                // const response = await fetch('YOUR_GOOGLE_APPS_SCRIPT_URL', {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json',
                //     },
                //     body: JSON.stringify({
                //         action: 'addSale',
                //         data: saleData
                //     })
                // });

                // return response.ok;

                // ตอนนี้จะ return true เพื่อจำลองการบันทึกสำเร็จ
                return true;
            } catch (error) {
                console.error('Error saving to Google Sheets:', error);
                return false;
            }
        }

        function loadData() {
            const savedSales = localStorage.getItem('beveragePOSSales');
            if (savedSales) {
                sales = JSON.parse(savedSales);
            }

            const savedProducts = localStorage.getItem('beveragePOSProducts');
            if (savedProducts) {
                products = JSON.parse(savedProducts);
            }

            const savedMaterials = localStorage.getItem('beveragePOSMaterials');
            if (savedMaterials) {
                materials = JSON.parse(savedMaterials);
            }
        }

        function saveData() {
            localStorage.setItem('beveragePOSSales', JSON.stringify(sales));
            localStorage.setItem('beveragePOSProducts', JSON.stringify(products));
            localStorage.setItem('beveragePOSMaterials', JSON.stringify(materials));
        }

        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];

            // คำนวณข้อมูลวันนี้
            const todaySales = sales.filter(sale => sale.date === today);
            const todayRevenue = todaySales.reduce((sum, sale) => sum + (sale.quantity * sale.price), 0);
            const todayProfit = todaySales.reduce((sum, sale) => sum + (sale.quantity * (sale.price - sale.cost)), 0);
            const todayQuantity = todaySales.reduce((sum, sale) => sum + sale.quantity, 0);

            // คำนวณข้อมูลเดือนนี้
            const currentMonth = new Date().toISOString().substring(0, 7);
            const monthSales = sales.filter(sale => sale.date.startsWith(currentMonth));
            const monthRevenue = monthSales.reduce((sum, sale) => sum + (sale.quantity * sale.price), 0);

            // อัปเดต UI
            document.getElementById('todayRevenue').textContent = '฿' + todayRevenue.toLocaleString();
            document.getElementById('todayProfit').textContent = '฿' + todayProfit.toLocaleString();
            document.getElementById('todayQuantity').textContent = todayQuantity.toLocaleString();
            document.getElementById('monthRevenue').textContent = '฿' + monthRevenue.toLocaleString();

            // อัปเดตกราฟและข้อมูลอื่น ๆ
            updateSalesChart();
            updateBestSelling();
            updateLowStockAlert();
        }

        function updateSalesChart() {
            const canvas = document.getElementById('salesChart');
            const ctx = canvas.getContext('2d');

            // เตรียมข้อมูลสำหรับกราฟ
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateString = date.toISOString().split('T')[0];
                last7Days.push(dateString);
            }

            const chartData = last7Days.map(date => {
                const daySales = sales.filter(sale => sale.date === date);
                const revenue = daySales.reduce((sum, sale) => sum + (sale.quantity * sale.price), 0);
                const profit = daySales.reduce((sum, sale) => sum + (sale.quantity * (sale.price - sale.cost)), 0);
                return { date, revenue, profit };
            });

            // ลบกราฟเก่าและวาดใหม่
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // สร้างกราฟแบบง่าย ๆ
            const padding = 50;
            const chartWidth = canvas.width - (padding * 2);
            const chartHeight = canvas.height - (padding * 2);

            const maxRevenue = Math.max(...chartData.map(d => d.revenue), 100);
            const stepX = chartWidth / (chartData.length - 1);

            // วาดแกน
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();

            // วาดเส้นรายได้
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            chartData.forEach((data, index) => {
                const x = padding + (index * stepX);
                const y = canvas.height - padding - ((data.revenue / maxRevenue) * chartHeight);
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // วาดเส้นกำไร
            ctx.strokeStyle = '#28a745';
            ctx.lineWidth = 3;
            ctx.beginPath();
            chartData.forEach((data, index) => {
                const x = padding + (index * stepX);
                const y = canvas.height - padding - ((data.profit / maxRevenue) * chartHeight);
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // วาดจุด
            chartData.forEach((data, index) => {
                const x = padding + (index * stepX);

                // จุดรายได้
                const yRevenue = canvas.height - padding - ((data.revenue / maxRevenue) * chartHeight);
                ctx.fillStyle = '#667eea';
                ctx.beginPath();
                ctx.arc(x, yRevenue, 4, 0, 2 * Math.PI);
                ctx.fill();

                // จุดกำไร
                const yProfit = canvas.height - padding - ((data.profit / maxRevenue) * chartHeight);
                ctx.fillStyle = '#28a745';
                ctx.beginPath();
                ctx.arc(x, yProfit, 4, 0, 2 * Math.PI);
                ctx.fill();

                // ป้ายกำกับวันที่
                ctx.fillStyle = '#666';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                const dateLabel = new Date(data.date).getDate() + '/' + (new Date(data.date).getMonth() + 1);
                ctx.fillText(dateLabel, x, canvas.height - padding + 20);
            });

            // เคียว legend
            ctx.fillStyle = '#667eea';
            ctx.fillRect(padding, 20, 15, 15);
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('รายได้', padding + 25, 32);

            ctx.fillStyle = '#28a745';
            ctx.fillRect(padding + 100, 20, 15, 15);
            ctx.fillText('กำไร', padding + 125, 32);
        }

        function updateBestSelling() {
            const productSales = {};
            sales.forEach(sale => {
                if (!productSales[sale.productName]) {
                    productSales[sale.productName] = 0;
                }
                productSales[sale.productName] += sale.quantity;
            });

            const bestSelling = Object.entries(productSales)
                .map(([name, quantity]) => ({ name, quantity }))
                .sort((a, b) => b.quantity - a.quantity)
                .slice(0, 5);

            const html = bestSelling.length > 0 ?
                bestSelling.map((item, index) => {
                    const product = products.find(p => p.name === item.name);
                    const profit = product ? (product.price - product.cost) * item.quantity : 0;
                    return `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid rgba(0,0,0,0.1);">
                            <div>
                                <span style="font-weight: 600; font-size: 1.1rem;">${index + 1}. ${item.name}</span>
                                <div style="color: #666; font-size: 0.9rem;">กำไร: ฿${profit.toLocaleString()}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: bold; font-size: 1.2rem; color: #667eea;">${item.quantity} แก้ว</div>
                            </div>
                        </div>
                    `;
                }).join('') :
                '<div class="empty-state"><div class="icon">📊</div><p>ยังไม่มีข้อมูลการขาย</p></div>';

            document.getElementById('bestSelling').innerHTML = html;
        }

        function updateLowStockAlert() {
            const lowStockMaterials = materials.filter(m => m.stock <= m.minStock);
            const alertDiv = document.getElementById('lowStockAlert');
            const listDiv = document.getElementById('lowStockList');

            if (lowStockMaterials.length > 0) {
                alertDiv.style.display = 'block';
                const html = lowStockMaterials.map(material => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255, 107, 107, 0.1); border: 1px solid rgba(255, 107, 107, 0.3); border-radius: 10px; margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: 600; color: #dc3545;">${material.name}</div>
                            <div style="color: #666; font-size: 0.9rem;">เหลือ: ${material.stock} ${material.unit} (ขั้นต่ำ: ${material.minStock})</div>
                        </div>
                        <button class="btn btn-warning" style="padding: 8px 16px;" onclick="addStock(${material.id})">
                            ➕ เพิ่มสต็อก
                        </button>
                    </div>
                `).join('');
                listDiv.innerHTML = html;
            } else {
                alertDiv.style.display = 'none';
            }
        }

        function renderProducts() {
            const html = products.map(product => {
                const stockStatus = product.stock <= 10 ? 'status-low' : product.stock <= 20 ? 'status-medium' : 'status-good';
                return `
                    <div class="product-card">
                        <div class="product-name">${product.name}</div>
                        <div class="product-category">${product.category}</div>
                        <div class="product-price">฿${product.price.toLocaleString()}</div>
                        <div class="product-stock">
                            สต็อก: <span class="status-badge ${stockStatus}">${product.stock}</span>
                        </div>
                        <div style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">
                            กำไร: ฿${(product.price - product.cost).toLocaleString()}/แก้ว
                        </div>
                        <button class="btn btn-primary" onclick="addToCart(${product.id})" 
                                ${product.stock === 0 ? 'disabled' : ''}>
                            🛒 เพิ่มลงตะกร้า
                        </button>
                    </div>
                `;
            }).join('');

            document.getElementById('productsList').innerHTML = html;
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.stock === 0) return;

            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity += 1;
                } else {
                    showAlert('สต็อกไม่เพียงพอ!', 'error');
                    return;
                }
            } else {
                cart.push({ ...product, quantity: 1 });
            }

            updateCartDisplay();
        }

        function updateCartQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            const product = products.find(p => p.id === productId);

            if (!item || !product) return;

            const newQuantity = item.quantity + change;

            if (newQuantity <= 0) {
                cart = cart.filter(item => item.id !== productId);
            } else if (newQuantity <= product.stock) {
                item.quantity = newQuantity;
            } else {
                showAlert('สต็อกไม่เพียงพอ!', 'error');
                return;
            }

            updateCartDisplay();
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartDisplay();
        }

        function updateCartDisplay() {
            const cartContainer = document.getElementById('cartItems');
            const cartSummary = document.getElementById('cartSummary');

            if (cart.length === 0) {
                cartContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">🛒</div>
                        <p>ไม่มีสินค้าในตะกร้า</p>
                    </div>
                `;
                cartSummary.style.display = 'none';
                return;
            }

            const html = cart.map(item => `
                <div class="cart-item">
                    <div>
                        <div style="font-weight: 600; margin-bottom: 5px;">${item.name}</div>
                        <div style="color: #666; font-size: 0.9rem;">฿${item.price.toLocaleString()} × ${item.quantity} = ฿${(item.price * item.quantity).toLocaleString()}</div>
                    </div>
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="updateCartQuantity(${item.id}, -1)">-</button>
                        <span style="margin: 0 10px; font-weight: 600;">${item.quantity}</span>
                        <button class="quantity-btn" onclick="updateCartQuantity(${item.id}, 1)">+</button>
                        <button class="btn btn-danger" style="margin-left: 10px; padding: 8px 12px; font-size: 0.9rem;" onclick="removeFromCart(${item.id})">
                            🗑️
                        </button>
                    </div>
                </div>
            `).join('');

            cartContainer.innerHTML = html;

            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const profit = cart.reduce((sum, item) => sum + ((item.price - item.cost) * item.quantity), 0);

            document.getElementById('cartTotal').textContent = '฿' + total.toLocaleString();
            document.getElementById('cartProfit').textContent = '฿' + profit.toLocaleString();
            cartSummary.style.display = 'block';
        }

        async function processSale() {
            if (cart.length === 0) {
                showAlert('ไม่มีสินค้าในตะกร้า', 'error');
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const timestamp = new Date().toISOString();

            // เตรียมข้อมูลสำหรับบันทึก
            const saleData = cart.map((item, index) => ({
                id: Date.now() + index,
                date: today,
                timestamp: timestamp,
                productId: item.id,
                productName: item.name,
                quantity: item.quantity,
                price: item.price,
                cost: item.cost,
                revenue: item.price * item.quantity,
                profit: (item.price - item.cost) * item.quantity
            }));

            try {
                // แสดง loading
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '<span class="loading"></span> กำลังบันทึก...';
                button.disabled = true;

                // บันทึกลง Google Sheets
                const success = await saveToGoogleSheets(saleData);

                if (success) {
                    // บันทึกใน localStorage (สำรอง)
                    sales.push(...saleData);

                    // อัปเดตสต็อกสินค้า
                    cart.forEach(cartItem => {
                        const product = products.find(p => p.id === cartItem.id);
                        if (product) {
                            product.stock -= cartItem.quantity;
                        }
                    });

                    saveData();

                    // ล้างตะกร้า
                    cart = [];
                    updateCartDisplay();

                    // อัปเดต UI
                    renderProducts();
                    updateDashboard();
                    updateRecentSales();

                    showAlert('✅ บันทึกการขายเรียบร้อย! ข้อมูลได้ถูกบันทึกไปยัง Google Sheets แล้ว', 'success');
                } else {
                    throw new Error('ไม่สามารถบันทึกไปยัง Google Sheets ได้');
                }

                // คืนค่าปุ่ม
                button.innerHTML = originalText;
                button.disabled = false;

            } catch (error) {
                console.error('Error processing sale:', error);
                showAlert('❌ เกิดข้อผิดพลาดในการบันทึกการขาย กรุณาลองใหม่อีกครั้ง', 'error');

                // คืนค่าปุ่ม
                const button = event.target;
                button.innerHTML = '💳 บันทึกการขาย';
                button.disabled = false;
            }
        }

        function updateRecentSales() {
            const recent = sales.slice(-10).reverse(); // แสดง 10 รายการล่าสุด เรียงจากใหม่ไปเก่า
            const container = document.getElementById('recentSales');

            if (recent.length === 0) {
                container.innerHTML = `
            <div class="empty-state">
                <div class="icon">📝</div>
                <p>ยังไม่มีประวัติการขาย</p>
            </div>
        `;
                return;
            }

            const html = `
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>วันที่/เวลา</th>
                        <th>สินค้า</th>
                        <th>จำนวน</th>
                        <th>ราคา</th>
                        <th>รวม</th>
                        <th>กำไร</th>
                        <th>จัดการ</th> <!-- คอลัมน์ใหม่สำหรับปุ่มลบ -->
                    </tr>
                </thead>
                <tbody>
                    ${recent.map(sale => `
                        <tr>
                            <td>${new Date(sale.timestamp || sale.date).toLocaleString('th-TH')}</td>
                            <td style="font-weight: 600;">${sale.productName}</td>
                            <td style="text-align: center;">${sale.quantity}</td>
                            <td style="text-align: right;">฿${sale.price.toLocaleString()}</td>
                            <td style="text-align: right;">฿${(sale.price * sale.quantity).toLocaleString()}</td>
                            <td style="text-align: right; color: #28a745;">฿${((sale.price - sale.cost) * sale.quantity).toLocaleString()}</td>
                            <td style="text-align: center;">
                                <button class="btn-delete" onclick="deleteSale(${sale.id})" title="ลบรายการนี้">
                                    <i class="fas fa-trash-alt"></i> ลบ
                                </button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    `;
            container.innerHTML = html;
        }

        async function deleteSale(saleId) {
            // ใช้ SweetAlert2 สำหรับการยืนยันการลบ
            const { isConfirmed } = await Swal.fire({
                title: 'ยืนยันการลบรายการ',
                text: 'คุณแน่ใจหรือไม่ว่าต้องการลบรายการขายนี้?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'ลบ',
                cancelButtonText: 'ยกเลิก'
            });

            if (!isConfirmed) return;

            try {
                // ค้นหารายการที่ต้องการลบ
                const index = sales.findIndex(sale => sale.id === saleId);
                if (index !== -1) {
                    // คืนสต็อกสินค้า
                    const deletedSale = sales[index];
                    const product = products.find(p => p.id === deletedSale.productId);
                    if (product) {
                        product.stock += deletedSale.quantity;
                    }

                    // ลบรายการออกจากอาร์เรย์
                    sales.splice(index, 1);

                    // บันทึกการเปลี่ยนแปลง
                    saveData();

                    // อัปเดต UI
                    updateRecentSales();
                    updateDashboard();
                    renderProducts();

                    // แจ้งเตือนเมื่อลบสำเร็จ
                    await Swal.fire({
                        title: 'สำเร็จ!',
                        text: 'ลบรายการขายเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });
                }
            } catch (error) {
                console.error('Error deleting sale:', error);
                Swal.fire({
                    title: 'เกิดข้อผิดพลาด!',
                    text: 'ไม่สามารถลบรายการได้',
                    icon: 'error'
                });
            }
        }

        function renderProductsTable() {
            const html = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>สินค้า</th>
                            <th>หมวดหมู่</th>
                            <th>ราคาขาย</th>
                            <th>ต้นทุน</th>
                            <th>กำไร/แก้ว</th>
                            <th>สต็อก</th>
                            <th>จัดการ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${products.map(product => {
                const stockStatus = product.stock <= 10 ? 'status-low' : product.stock <= 20 ? 'status-medium' : 'status-good';
                return `
                                <tr>
                                    <td style="font-weight: 600;">${product.name}</td>
                                    <td>${product.category}</td>
                                    <td style="text-align: right;">฿${product.price.toLocaleString()}</td>
                                    <td style="text-align: right;">฿${product.cost.toLocaleString()}</td>
                                    <td style="text-align: right; color: #28a745; font-weight: 600;">฿${(product.price - product.cost).toLocaleString()}</td>
                                    <td style="text-align: center;">
                                        <span class="status-badge ${stockStatus}">
                                            ${product.stock}
                                        </span>
                                    </td>
                                    <td style="text-align: center;">
                                        <button class="btn btn-primary" style="padding: 8px 16px; margin-right: 8px; font-size: 0.9rem;" onclick="editProduct(${product.id})">
                                            ✏️ แก้ไข
                                        </button>
                                        <button class="btn btn-danger" style="padding: 8px 16px; font-size: 0.9rem;" onclick="deleteProduct(${product.id})">
                                            🗑️ ลบ
                                        </button>
                                    </td>
                                </tr>
                            `;
            }).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('productsTable').innerHTML = html;
        }

        function renderMaterialsTable() {
            const html = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>วัตถุดิบ</th>
                            <th>หน่วย</th>
                            <th>สต็อกปัจจุบัน</th>
                            <th>สต็อกขั้นต่ำ</th>
                            <th>ต้นทุน/หน่วย</th>
                            <th>สถานะ</th>
                            <th>จัดการ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${materials.map(material => {
                const isLow = material.stock <= material.minStock;
                return `
                                <tr>
                                    <td style="font-weight: 600;">${material.name}</td>
                                    <td>${material.unit}</td>
                                    <td style="text-align: center; font-weight: 600;">${material.stock}</td>
                                    <td style="text-align: center;">${material.minStock}</td>
                                    <td style="text-align: right;">฿${material.cost.toLocaleString()}</td>
                                    <td style="text-align: center;">
                                        <span class="status-badge ${isLow ? 'status-low' : 'status-good'}">
                                            ${isLow ? '⚠️ ต่ำ' : '✅ ปกติ'}
                                        </span>
                                    </td>
                                    <td style="text-align: center;">
                                        <button class="btn btn-success" style="padding: 8px 12px; margin-right: 5px; font-size: 0.9rem;" onclick="addStock(${material.id})">
                                            ➕ เพิ่ม
                                        </button>
                                        <button class="btn btn-primary" style="padding: 8px 12px; margin-right: 5px; font-size: 0.9rem;" onclick="editMaterial(${material.id})">
                                            ✏️ แก้ไข
                                        </button>
                                        <button class="btn btn-danger" style="padding: 8px 12px; font-size: 0.9rem;" onclick="deleteMaterial(${material.id})">
                                            🗑️ ลบ
                                        </button>
                                    </td>
                                </tr>
                            `;
            }).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('materialsTable').innerHTML = html;
        }

        function updateReports() {
            const totalRevenue = sales.reduce((sum, sale) => sum + (sale.quantity * sale.price), 0);
            const totalProfit = sales.reduce((sum, sale) => sum + (sale.quantity * (sale.price - sale.cost)), 0);
            const totalQuantity = sales.reduce((sum, sale) => sum + sale.quantity, 0);
            const profitMargin = totalRevenue > 0 ? ((totalProfit / totalRevenue) * 100).toFixed(1) : 0;

            document.getElementById('totalRevenue').textContent = '฿' + totalRevenue.toLocaleString();
            document.getElementById('totalProfit').textContent = '฿' + totalProfit.toLocaleString();
            document.getElementById('totalQuantity').textContent = totalQuantity.toLocaleString();
            document.getElementById('profitMargin').textContent = profitMargin + '%';

            updateProductReports();
        }

        function updateProductReports() {
            const productStats = {};

            // คำนวณสถิติของแต่ละสินค้า
            sales.forEach(sale => {
                if (!productStats[sale.productName]) {
                    productStats[sale.productName] = {
                        name: sale.productName,
                        totalQuantity: 0,
                        totalRevenue: 0,
                        totalProfit: 0
                    };
                }
                productStats[sale.productName].totalQuantity += sale.quantity;
                productStats[sale.productName].totalRevenue += sale.quantity * sale.price;
                productStats[sale.productName].totalProfit += sale.quantity * (sale.price - sale.cost);
            });

            const productReportData = Object.values(productStats)
                .sort((a, b) => b.totalRevenue - a.totalRevenue);

            if (productReportData.length === 0) {
                document.getElementById('productReports').innerHTML = `
                    <div class="empty-state">
                        <div class="icon">📊</div>
                        <p>ยังไม่มีข้อมูลการขาย</p>
                    </div>
                `;
                return;
            }

            const html = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>สินค้า</th>
                            <th>จำนวนขาย</th>
                            <th>รายได้</th>
                            <th>กำไร</th>
                            <th>อัตรากำไร</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${productReportData.map(product => {
                const profitRate = product.totalRevenue > 0 ? ((product.totalProfit / product.totalRevenue) * 100).toFixed(1) : 0;
                return `
                                <tr>
                                    <td style="font-weight: 600;">${product.name}</td>
                                    <td style="text-align: center; font-weight: 600;">${product.totalQuantity}</td>
                                    <td style="text-align: right; font-weight: 600;">฿${product.totalRevenue.toLocaleString()}</td>
                                    <td style="text-align: right; color: #28a745; font-weight: 600;">฿${product.totalProfit.toLocaleString()}</td>
                                    <td style="text-align: right; font-weight: 600;">${profitRate}%</td>
                                </tr>
                            `;
            }).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('productReports').innerHTML = html;
        }

        // Modal functions
        function showAddProductModal() {
            document.getElementById('addProductModal').style.display = 'block';
        }

        function showAddMaterialModal() {
            document.getElementById('addMaterialModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        async function addProduct(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);

            try {
                // ตรวจสอบข้อมูลก่อนบันทึก
                const name = formData.get('name').trim();
                const price = parseFloat(formData.get('price'));
                const cost = parseFloat(formData.get('cost'));
                const stock = parseInt(formData.get('stock'));
                const category = formData.get('category').trim();

                if (!name || isNaN(price) || isNaN(cost) || isNaN(stock)) {
                    throw new Error('กรุณากรอกข้อมูลให้ครบถ้วนและถูกต้อง');
                }

                if (price <= 0 || cost <= 0 || stock < 0) {
                    throw new Error('ราคาและจำนวนสต็อกต้องเป็นตัวเลขบวก');
                }

                // สร้าง ID ใหม่
                const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;

                // สร้าง object สินค้าใหม่
                const newProduct = {
                    id: newId,
                    name,
                    price,
                    cost,
                    stock,
                    category
                };

                // เพิ่มสินค้าใหม่
                products.push(newProduct);

                // บันทึกข้อมูล
                saveData();

                // อัพเดท UI ทั้งหมดที่เกี่ยวข้อง
                updateAllProductViews();

                // ปิด modal และรีเซ็ตฟอร์ม
                closeModal('addProductModal');
                form.reset();

                // แจ้งเตือนสำเร็จ
                await Swal.fire({
                    title: 'สำเร็จ!',
                    text: 'เพิ่มสินค้าเรียบร้อย',
                    icon: 'success',
                    timer: 1500,
                    showConfirmButton: false
                });

            } catch (error) {
                // แจ้งเตือนข้อผิดพลาด
                await Swal.fire({
                    title: 'เกิดข้อผิดพลาด',
                    text: error.message,
                    icon: 'error',
                    confirmButtonText: 'ตกลง'
                });
                console.error('Error adding product:', error);
            }
        }

        // ฟังก์ชันสำหรับอัพเดททุกส่วนที่แสดงสินค้า
        function updateAllProductViews() {
            renderProducts();      // อัพเดทหน้าขาย
            renderProductsTable(); // อัพเดทตารางจัดการสินค้า
            updateDashboard();     // อัพเดทแดชบอร์ด (ถ้ามีผลต่อข้อมูล)

            // แจ้งเตือนการเปลี่ยนแปลง (สำหรับส่วนอื่นที่อาจต้องการอัพเดท)
            window.dispatchEvent(new CustomEvent('products-updated'));
        }
        function addMaterial(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const newMaterial = {
                id: Math.max(...materials.map(m => m.id), 0) + 1,
                name: formData.get('name'),
                unit: formData.get('unit'),
                stock: parseInt(formData.get('stock')),
                cost: parseFloat(formData.get('cost')),
                minStock: parseInt(formData.get('minStock'))
            };

            materials.push(newMaterial);
            saveData();
            renderMaterialsTable();
            updateLowStockAlert();
            closeModal('addMaterialModal');
            event.target.reset();
            showAlert('✅ เพิ่มวัตถุดิบเรียบร้อย!', 'success');
        }

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;

            const form = document.getElementById('editProductForm');
            form.elements.id.value = product.id;
            form.elements.name.value = product.name;
            form.elements.price.value = product.price;
            form.elements.cost.value = product.cost;
            form.elements.stock.value = product.stock;
            form.elements.category.value = product.category;

            document.getElementById('editProductModal').style.display = 'block';
        }

        function updateProduct(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const id = parseInt(formData.get('id'));

            const productIndex = products.findIndex(p => p.id === id);
            if (productIndex === -1) return;

            products[productIndex] = {
                id: id,
                name: formData.get('name'),
                price: parseFloat(formData.get('price')),
                cost: parseFloat(formData.get('cost')),
                stock: parseInt(formData.get('stock')),
                category: formData.get('category')
            };

            saveData();
            renderProducts();
            renderProductsTable();
            closeModal('editProductModal');
            showAlert('✅ อัปเดตสินค้าเรียบร้อย!', 'success');
        }

        function deleteProduct(id) {
            Swal.fire({
                title: 'คุณแน่ใจหรือไม่?',
                text: "คุณต้องการลบสินค้านี้ใช่หรือไม่?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'ใช่, ลบเลย!',
                cancelButtonText: 'ยกเลิก'
            }).then((result) => {
                if (result.isConfirmed) {
                    products = products.filter(p => p.id !== id);
                    cart = cart.filter(item => item.id !== id);
                    saveData();
                    renderProducts();
                    renderProductsTable();
                    updateCartDisplay();

                    Swal.fire({
                        icon: 'success',
                        title: 'ลบสินค้าเรียบร้อย!',
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
            });
        }


        function deleteMaterial(id) {
            if (confirm('คุณแน่ใจหรือไม่ที่จะลบวัตถุดิบนี้?')) {
                materials = materials.filter(m => m.id !== id);
                saveData();
                renderMaterialsTable();
                updateLowStockAlert();
                showAlert('✅ ลบวัตถุดิบเรียบร้อย!', 'success');
            }
        }

        function addStock(id) {
            const material = materials.find(m => m.id === id);
            if (!material) return;

            Swal.fire({
                title: `เพิ่มสต็อกให้กับ "${material.name}"`,
                input: 'number',
                inputLabel: 'ระบุจำนวนที่ต้องการเพิ่ม',
                inputAttributes: {
                    min: 1,
                    step: 1
                },
                inputPlaceholder: 'เช่น 10',
                showCancelButton: true,
                confirmButtonText: 'เพิ่ม',
                cancelButtonText: 'ยกเลิก',
                preConfirm: (value) => {
                    if (!value || isNaN(value) || parseInt(value) <= 0) {
                        Swal.showValidationMessage('กรุณากรอกจำนวนที่ถูกต้อง (มากกว่า 0)');
                    }
                    return value;
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const quantity = parseInt(result.value);
                    material.stock += quantity;
                    saveData();
                    renderMaterialsTable();
                    updateLowStockAlert();

                    Swal.fire({
                        icon: 'success',
                        title: 'เพิ่มสต็อกเรียบร้อย!',
                        text: `เพิ่ม ${quantity} ชิ้นให้กับ "${material.name}"`,
                        showConfirmButton: false,
                        timer: 2000
                    });
                }
            });
        }


        function editMaterial(id) {
            const material = materials.find(m => m.id === id);
            if (!material) return;

            Swal.fire({
                title: `แก้ไขจำนวนสต็อก "${material.name}"`,
                input: 'number',
                inputLabel: `จำนวนปัจจุบัน: ${material.stock} ${material.unit}`,
                inputValue: material.stock,
                inputAttributes: {
                    min: 0,
                    step: 1
                },
                showCancelButton: true,
                confirmButtonText: 'อัปเดต',
                cancelButtonText: 'ยกเลิก',
                preConfirm: (value) => {
                    if (value === '' || isNaN(value) || parseInt(value) < 0) {
                        Swal.showValidationMessage('กรุณากรอกจำนวนที่ถูกต้อง (0 ขึ้นไป)');
                    }
                    return value;
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const newStock = parseInt(result.value);
                    material.stock = newStock;
                    saveData();
                    renderMaterialsTable();
                    updateLowStockAlert();

                    Swal.fire({
                        icon: 'success',
                        title: 'อัปเดตสต็อกเรียบร้อย!',
                        text: `จำนวนใหม่ของ "${material.name}" คือ ${newStock} ${material.unit}`,
                        showConfirmButton: false,
                        timer: 2000
                    });
                }
            });
        }


        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type === 'success' ? 'success' : 'danger'}`;
            alertDiv.innerHTML = message;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.style.minWidth = '350px';
            alertDiv.style.maxWidth = '500px';
            alertDiv.style.boxShadow = '0 15px 35px rgba(0,0,0,0.2)';
            alertDiv.style.animation = 'slideInRight 0.3s ease';

            document.body.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 300);
            }, 4000);
        }

        // Close modals when clicking outside
        window.onclick = function (event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function (event) {
            // Alt + 1-5 for tab switching
            if (event.altKey) {
                switch (event.key) {
                    case '1':
                        event.preventDefault();
                        document.querySelector('[onclick="showTab(\'dashboard\')"]').click();
                        break;
                    case '2':
                        event.preventDefault();
                        document.querySelector('[onclick="showTab(\'sales\')"]').click();
                        break;
                    case '3':
                        event.preventDefault();
                        document.querySelector('[onclick="showTab(\'products\')"]').click();
                        break;
                    case '4':
                        event.preventDefault();
                        document.querySelector('[onclick="showTab(\'materials\')"]').click();
                        break;
                    case '5':
                        event.preventDefault();
                        document.querySelector('[onclick="showTab(\'reports\')"]').click();
                        break;
                }
            }

            // Escape key to close modals
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }
        });

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialize recent sales display after a short delay
        setTimeout(() => {
            updateRecentSales();
        }, 100);
    </script>

</body>

</html>