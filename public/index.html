<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö POS ‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
            padding: 0 20px;
        }

        .nav-tab {
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            color: #333;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .nav-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö */
        .btn-delete {
            background-color: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .btn-delete:hover {
            background-color: #cc0000;
            transform: translateY(-1px);
        }

        .btn-delete i {
            font-size: 0.8rem;
        }

        /* ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô Font Awesome */
        @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css');

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .stat-value {
            font-size: 3rem;
            font-weight: bold;
            margin: 15px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: #666;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .product-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #56ccf2 0%, #2f80ed 100%);
        }

        .product-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .product-name {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .product-category {
            color: #666;
            font-size: 1rem;
            margin-bottom: 15px;
            padding: 5px 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 20px;
            display: inline-block;
        }

        .product-price {
            font-size: 2rem;
            font-weight: bold;
            margin: 15px 0;
            background: linear-gradient(135deg, #56ccf2 0%, #2f80ed 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .product-stock {
            color: #666;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ccf2 0%, #2f80ed 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(86, 204, 242, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #feca57 0%, #ff9f43 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(254, 202, 87, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .cart {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            position: sticky;
            top: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .cart h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.5rem;
            text-align: center;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .quantity-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 1.1rem;
        }

        .form-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 15px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
            background: white;
        }

        .table-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 20px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .alert {
            padding: 20px 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-weight: 500;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .alert-success {
            background: rgba(40, 167, 69, 0.1);
            color: #155724;
        }

        .alert-success::before {
            background: #28a745;
        }

        .alert-danger {
            background: rgba(220, 53, 69, 0.1);
            color: #721c24;
        }

        .alert-danger::before {
            background: #dc3545;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            margin: 5% auto;
            padding: 40px;
            border-radius: 25px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #667eea;
        }

        .loading {
            display: inline-block;
            width: 25px;
            height: 25px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .empty-state {
            text-align: center;
            color: #666;
            padding: 60px 20px;
            font-size: 1.1rem;
        }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            text-align: center;
            display: inline-block;
        }

        .status-low {
            background: rgba(255, 107, 107, 0.2);
            color: #dc3545;
        }

        .status-medium {
            background: rgba(254, 202, 87, 0.2);
            color: #fd7e14;
        }

        .status-good {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .nav-tabs {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 10px;
            }

            .nav-tab {
                white-space: nowrap;
                flex-shrink: 0;
                padding: 12px 20px;
                font-size: 14px;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .stat-value {
                font-size: 2rem;
            }

            .table th,
            .table td {
                padding: 12px 8px;
                font-size: 14px;
            }

            .modal-content {
                margin: 10% auto;
                padding: 25px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ü•§ ‡∏£‡∏∞‡∏ö‡∏ö POS ‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</h1>
            <p style="font-size: 1.2rem; color: #666; margin-top: 10px;">
                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="currentDate"></span>
            </p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
            <button class="nav-tab" onclick="showTab('sales')">üõí ‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            <button class="nav-tab" onclick="showTab('products')">üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            <button class="nav-tab" onclick="showTab('materials')">ü•§ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</button>
            <button class="nav-tab" onclick="showTab('reports')">üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">üí∞ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                    <div class="stat-value" id="todayRevenue">‡∏ø0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üìà ‡∏Å‡∏≥‡πÑ‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                    <div class="stat-value" id="todayProfit">‡∏ø0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ü•§ ‡πÅ‡∏Å‡πâ‡∏ß‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                    <div class="stat-value" id="todayQuantity">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üíµ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
                    <div class="stat-value" id="monthRevenue">‡∏ø0</div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 20px; font-size: 1.5rem;">üìä ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (7 ‡∏ß‡∏±‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á)</h3>
                <div class="chart-container">
                    <canvas id="salesChart" width="400" height="300"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 20px; font-size: 1.5rem;">üèÜ ‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ TOP 5</h3>
                <div id="bestSelling"></div>
            </div>

            <div class="card" id="lowStockAlert" style="display: none;">
                <h3 style="margin-bottom: 20px; font-size: 1.5rem; color: #dc3545;">‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</h3>
                <div id="lowStockList"></div>
            </div>
        </div>

        <!-- Sales Tab -->
        <div id="sales" class="tab-content">
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
                <div>
                    <div class="card">
                        <h3 style="margin-bottom: 25px; font-size: 1.5rem;">üõçÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                        <div class="products-grid" id="productsList">
                            <!-- Products will be loaded here -->
                        </div>
                    </div>
                </div>

                <div class="cart">
                    <h3>üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                    <div id="cartItems">
                        <div class="empty-state">
                            <div class="icon">üõí</div>
                            <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
                        </div>
                    </div>
                    <div id="cartSummary" style="display: none;">
                        <hr style="margin: 25px 0; border: none; height: 1px; background: rgba(0,0,0,0.1);">
                        <div
                            style="display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 1.1rem;">
                            <strong>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°:</strong>
                            <strong id="cartTotal" style="color: #28a745;">‡∏ø0</strong>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; margin-bottom: 25px; font-size: 1.1rem;">
                            <strong>‡∏Å‡∏≥‡πÑ‡∏£:</strong>
                            <strong style="color: #007bff;" id="cartProfit">‡∏ø0</strong>
                        </div>

                        <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô -->
                        <button class="btn btn-success" style="width: 100%; font-size: 1.1rem;"
                            onclick="confirmPaymentBeforeSale()">
                            üí≥ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                        </button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 25px; font-size: 1.5rem;">üìù ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                <div id="recentSales"></div>
            </div>
        </div>

        <!-- ‚úÖ SweetAlert2 CDN -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <!-- ‚úÖ JavaScript -->
        <script>
            function confirmPaymentBeforeSale() {
                Swal.fire({
                    title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô?',
                    text: "‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß?",
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô',
                    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                    reverseButtons: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        processSale();
                    }
                });
            }

            function processSale() {
                // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                // ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á database ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà

                Swal.fire({
                    icon: 'success',
                    title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    text: '‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                });

                // ‚úÖ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                document.getElementById("cartItems").innerHTML = `
            <div class="empty-state">
                <div class="icon">üõí</div>
                <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
            </div>`;
                document.getElementById("cartSummary").style.display = "none";
                document.getElementById("cartTotal").innerText = "‡∏ø0";
                document.getElementById("cartProfit").innerText = "‡∏ø0";

                // ‚úÖ TODO: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï recentSales ‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            }
        </script>



    </div>

    <!-- Products Tab -->
    <div id="products" class="tab-content">
        <div class="card">
            <div
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                <h3 style="font-size: 1.5rem;">üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                <button class="btn btn-primary" onclick="showAddProductModal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</button>
            </div>
            <div class="table-container" id="productsTable"></div>
        </div>
    </div>

    <!-- Materials Tab -->
    <div id="materials" class="tab-content">
        <div class="card">
            <div
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                <h3 style="font-size: 1.5rem;">ü•§ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h3>
                <button class="btn btn-primary" onclick="showAddMaterialModal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏´‡∏°‡πà</button>
            </div>
            <div class="table-container" id="materialsTable"></div>
        </div>
    </div>

    <!-- Reports Tab -->
    <div id="reports" class="tab-content">
        <div class="card">
            <h3 style="margin-bottom: 25px; font-size: 1.5rem;">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">üí∞ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    <div class="stat-value" id="totalRevenue">‡∏ø0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üìà ‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    <div class="stat-value" id="totalProfit">‡∏ø0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ü•§ ‡πÅ‡∏Å‡πâ‡∏ß‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    <div class="stat-value" id="totalQuantity">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üìä ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£</div>
                    <div class="stat-value" id="profitMargin">0%</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-bottom: 25px; font-size: 1.5rem;">üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
            <div class="table-container" id="productReports"></div>
        </div>
    </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addProductModal')">&times;</span>
            <h3 style="margin-bottom: 25px; font-size: 1.5rem;">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
            <form id="addProductForm" onsubmit="addProduct(event)">
                <div class="form-group">
                    <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</label>
                    <input type="text" class="form-input" name="name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢, ‡∏Å‡∏≤‡πÅ‡∏ü‡πÄ‡∏¢‡πá‡∏ô">
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó):</label>
                    <input type="number" class="form-input" name="price" required placeholder="25" min="1">
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏ö‡∏≤‡∏ó):</label>
                    <input type="number" class="form-input" name="cost" required placeholder="12" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å:</label>
                    <input type="number" class="form-input" name="stock" required placeholder="50" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:</label>
                    <input type="text" class="form-input" name="category" required
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏≤, ‡∏Å‡∏≤‡πÅ‡∏ü, ‡∏ô‡πâ‡∏≥‡∏ú‡∏•‡πÑ‡∏°‡πâ">
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%; font-size: 1.1rem;">
                    üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </button>
            </form>
        </div>
    </div>

    <!-- Add Material Modal -->
    <div id="addMaterialModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addMaterialModal')">&times;</span>
            <h3 style="margin-bottom: 25px; font-size: 1.5rem;">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏´‡∏°‡πà</h3>
            <form id="addMaterialForm" onsubmit="addMaterial(event)">
                <div class="form-group">
                    <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:</label>
                    <input type="text" class="form-input" name="name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡πâ‡∏≥, ‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á">
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏´‡∏ô‡πà‡∏ß‡∏¢:</label>
                    <input type="text" class="form-input" name="unit" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏¥‡∏ï‡∏£, ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°, ‡πÉ‡∏ö">
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å:</label>
                    <input type="number" class="form-input" name="stock" required placeholder="100" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ö‡∏≤‡∏ó):</label>
                    <input type="number" class="form-input" name="cost" step="0.01" required placeholder="2.50" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥:</label>
                    <input type="number" class="form-input" name="minStock" required placeholder="20" min="1">
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%; font-size: 1.1rem;">
                    üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö
                </button>
            </form>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div id="editProductModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editProductModal')">&times;</span>
            <h3 style="margin-bottom: 25px; font-size: 1.5rem;">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
            <form id="editProductForm" onsubmit="updateProduct(event)">
                <input type="hidden" name="id">
                <div class="form-group">
                    <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</label>
                    <input type="text" class="form-input" name="name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó):</label>
                    <input type="number" class="form-input" name="price" required min="1">
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏ö‡∏≤‡∏ó):</label>
                    <input type="number" class="form-input" name="cost" required min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å:</label>
                    <input type="number" class="form-input" name="stock" required min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:</label>
                    <input type="text" class="form-input" name="category" required>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%; font-size: 1.1rem;">
                    üíæ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </button>
            </form>
        </div>
    </div>

    <script>
        // Google Sheets Configuration
        const GOOGLE_SHEETS_URL = 'https://docs.google.com/spreadsheets/d/1H83uZSGkKSe5vNeRufTx8DC4U_t4a0qJIFG27e4vnEM/edit?gid=0#gid=0';

        // Sample data
        let products = [
            { id: 1, name: '‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢', price: 25, cost: 12, stock: 50, category: '‡∏ä‡∏≤' },
            { id: 2, name: '‡∏Å‡∏≤‡πÅ‡∏ü‡πÄ‡∏¢‡πá‡∏ô', price: 30, cost: 15, stock: 40, category: '‡∏Å‡∏≤‡πÅ‡∏ü' },
            { id: 3, name: '‡∏ô‡πâ‡∏≥‡∏™‡πâ‡∏°‡∏Ñ‡∏±‡πâ‡∏ô', price: 35, cost: 18, stock: 30, category: '‡∏ô‡πâ‡∏≥‡∏ú‡∏•‡πÑ‡∏°‡πâ' },
            { id: 4, name: '‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡πÄ‡∏¢‡πá‡∏ô', price: 28, cost: 14, stock: 35, category: '‡πÇ‡∏Å‡πÇ‡∏Å‡πâ' },
            { id: 5, name: '‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏•‡πà‡∏≤', price: 10, cost: 5, stock: 100, category: '‡∏ô‡πâ‡∏≥' },
            { id: 6, name: '‡∏ä‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß', price: 25, cost: 13, stock: 45, category: '‡∏ä‡∏≤' },
            { id: 7, name: '‡∏ô‡πâ‡∏≥‡∏°‡∏∞‡∏ô‡∏≤‡∏ß', price: 20, cost: 8, stock: 60, category: '‡∏ô‡πâ‡∏≥‡∏ú‡∏•‡πÑ‡∏°‡πâ' }
        ];

        let materials = [
            { id: 1, name: '‡∏ô‡πâ‡∏≥', unit: '‡∏•‡∏¥‡∏ï‡∏£', stock: 500, cost: 2, minStock: 50 },
            { id: 2, name: '‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á', unit: '‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°', stock: 20, cost: 10, minStock: 5 },
            { id: 3, name: '‡πÅ‡∏Å‡πâ‡∏ß‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å', unit: '‡πÉ‡∏ö', stock: 200, cost: 1.5, minStock: 50 },
            { id: 4, name: '‡∏ù‡∏≤‡πÅ‡∏Å‡πâ‡∏ß', unit: '‡πÉ‡∏ö', stock: 180, cost: 0.5, minStock: 40 },
            { id: 5, name: '‡∏´‡∏•‡∏≠‡∏î‡∏î‡∏π‡∏î', unit: '‡∏≠‡∏±‡∏ô', stock: 150, cost: 0.3, minStock: 30 },
            { id: 6, name: '‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•', unit: '‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°', stock: 25, cost: 25, minStock: 5 },
            { id: 7, name: '‡∏ô‡∏°', unit: '‡∏•‡∏¥‡∏ï‡∏£', stock: 15, cost: 35, minStock: 5 }
        ];

        let sales = [];
        let cart = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            updateCurrentDate();
            loadData();
            updateDashboard();
            renderProducts();
            renderProductsTable();
            renderMaterialsTable();
            updateRecentSales();
            updateLowStockAlert();
        });

        function updateCurrentDate() {
            const now = new Date();
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('th-TH', options);
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked nav tab
            event.target.classList.add('active');

            // Update data when switching tabs
            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'reports') {
                updateReports();
            }
        }

        async function saveToGoogleSheets(saleData) {
            try {
                // ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Google Apps Script Web App
                // ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ URL ‡∏Ç‡∏≠‡∏á Web App ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô
                console.log('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets:', saleData);

                // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡πÉ‡∏´‡πâ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏Ç‡∏≠‡∏á Google Apps Script
                // const response = await fetch('YOUR_GOOGLE_APPS_SCRIPT_URL', {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json',
                //     },
                //     body: JSON.stringify({
                //         action: 'addSale',
                //         data: saleData
                //     })
                // });

                // return response.ok;

                // ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞ return true ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                return true;
            } catch (error) {
                console.error('Error saving to Google Sheets:', error);
                return false;
            }
        }

        function loadData() {
            const savedSales = localStorage.getItem('beveragePOSSales');
            if (savedSales) {
                sales = JSON.parse(savedSales);
            }

            const savedProducts = localStorage.getItem('beveragePOSProducts');
            if (savedProducts) {
                products = JSON.parse(savedProducts);
            }

            const savedMaterials = localStorage.getItem('beveragePOSMaterials');
            if (savedMaterials) {
                materials = JSON.parse(savedMaterials);
            }
        }

        function saveData() {
            localStorage.setItem('beveragePOSSales', JSON.stringify(sales));
            localStorage.setItem('beveragePOSProducts', JSON.stringify(products));
            localStorage.setItem('beveragePOSMaterials', JSON.stringify(materials));
        }

        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            const todaySales = sales.filter(sale => sale.date === today);
            const todayRevenue = todaySales.reduce((sum, sale) => sum + (sale.quantity * sale.price), 0);
            const todayProfit = todaySales.reduce((sum, sale) => sum + (sale.quantity * (sale.price - sale.cost)), 0);
            const todayQuantity = todaySales.reduce((sum, sale) => sum + sale.quantity, 0);

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
            const currentMonth = new Date().toISOString().substring(0, 7);
            const monthSales = sales.filter(sale => sale.date.startsWith(currentMonth));
            const monthRevenue = monthSales.reduce((sum, sale) => sum + (sale.quantity * sale.price), 0);

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            document.getElementById('todayRevenue').textContent = '‡∏ø' + todayRevenue.toLocaleString();
            document.getElementById('todayProfit').textContent = '‡∏ø' + todayProfit.toLocaleString();
            document.getElementById('todayQuantity').textContent = todayQuantity.toLocaleString();
            document.getElementById('monthRevenue').textContent = '‡∏ø' + monthRevenue.toLocaleString();

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô ‡πÜ
            updateSalesChart();
            updateBestSelling();
            updateLowStockAlert();
        }

        function updateSalesChart() {
            const canvas = document.getElementById('salesChart');
            const ctx = canvas.getContext('2d');

            // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateString = date.toISOString().split('T')[0];
                last7Days.push(dateString);
            }

            const chartData = last7Days.map(date => {
                const daySales = sales.filter(sale => sale.date === date);
                const revenue = daySales.reduce((sum, sale) => sum + (sale.quantity * sale.price), 0);
                const profit = daySales.reduce((sum, sale) => sum + (sale.quantity * (sale.price - sale.cost)), 0);
                return { date, revenue, profit };
            });

            // ‡∏•‡∏ö‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏Å‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‡πÜ
            const padding = 50;
            const chartWidth = canvas.width - (padding * 2);
            const chartHeight = canvas.height - (padding * 2);

            const maxRevenue = Math.max(...chartData.map(d => d.revenue), 100);
            const stepX = chartWidth / (chartData.length - 1);

            // ‡∏ß‡∏≤‡∏î‡πÅ‡∏Å‡∏ô
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();

            // ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            chartData.forEach((data, index) => {
                const x = padding + (index * stepX);
                const y = canvas.height - padding - ((data.revenue / maxRevenue) * chartHeight);
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏Å‡∏≥‡πÑ‡∏£
            ctx.strokeStyle = '#28a745';
            ctx.lineWidth = 3;
            ctx.beginPath();
            chartData.forEach((data, index) => {
                const x = padding + (index * stepX);
                const y = canvas.height - padding - ((data.profit / maxRevenue) * chartHeight);
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // ‡∏ß‡∏≤‡∏î‡∏à‡∏∏‡∏î
            chartData.forEach((data, index) => {
                const x = padding + (index * stepX);

                // ‡∏à‡∏∏‡∏î‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ
                const yRevenue = canvas.height - padding - ((data.revenue / maxRevenue) * chartHeight);
                ctx.fillStyle = '#667eea';
                ctx.beginPath();
                ctx.arc(x, yRevenue, 4, 0, 2 * Math.PI);
                ctx.fill();

                // ‡∏à‡∏∏‡∏î‡∏Å‡∏≥‡πÑ‡∏£
                const yProfit = canvas.height - padding - ((data.profit / maxRevenue) * chartHeight);
                ctx.fillStyle = '#28a745';
                ctx.beginPath();
                ctx.arc(x, yProfit, 4, 0, 2 * Math.PI);
                ctx.fill();

                // ‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                ctx.fillStyle = '#666';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                const dateLabel = new Date(data.date).getDate() + '/' + (new Date(data.date).getMonth() + 1);
                ctx.fillText(dateLabel, x, canvas.height - padding + 20);
            });

            // ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏ß legend
            ctx.fillStyle = '#667eea';
            ctx.fillRect(padding, 20, 15, 15);
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ', padding + 25, 32);

            ctx.fillStyle = '#28a745';
            ctx.fillRect(padding + 100, 20, 15, 15);
            ctx.fillText('‡∏Å‡∏≥‡πÑ‡∏£', padding + 125, 32);
        }

        function updateBestSelling() {
            const productSales = {};
            sales.forEach(sale => {
                if (!productSales[sale.productName]) {
                    productSales[sale.productName] = 0;
                }
                productSales[sale.productName] += sale.quantity;
            });

            const bestSelling = Object.entries(productSales)
                .map(([name, quantity]) => ({ name, quantity }))
                .sort((a, b) => b.quantity - a.quantity)
                .slice(0, 5);

            const html = bestSelling.length > 0 ?
                bestSelling.map((item, index) => {
                    const product = products.find(p => p.name === item.name);
                    const profit = product ? (product.price - product.cost) * item.quantity : 0;
                    return `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid rgba(0,0,0,0.1);">
                            <div>
                                <span style="font-weight: 600; font-size: 1.1rem;">${index + 1}. ${item.name}</span>
                                <div style="color: #666; font-size: 0.9rem;">‡∏Å‡∏≥‡πÑ‡∏£: ‡∏ø${profit.toLocaleString()}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: bold; font-size: 1.2rem; color: #667eea;">${item.quantity} ‡πÅ‡∏Å‡πâ‡∏ß</div>
                            </div>
                        </div>
                    `;
                }).join('') :
                '<div class="empty-state"><div class="icon">üìä</div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</p></div>';

            document.getElementById('bestSelling').innerHTML = html;
        }

        function updateLowStockAlert() {
            const lowStockMaterials = materials.filter(m => m.stock <= m.minStock);
            const alertDiv = document.getElementById('lowStockAlert');
            const listDiv = document.getElementById('lowStockList');

            if (lowStockMaterials.length > 0) {
                alertDiv.style.display = 'block';
                const html = lowStockMaterials.map(material => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255, 107, 107, 0.1); border: 1px solid rgba(255, 107, 107, 0.3); border-radius: 10px; margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: 600; color: #dc3545;">${material.name}</div>
                            <div style="color: #666; font-size: 0.9rem;">‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${material.stock} ${material.unit} (‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥: ${material.minStock})</div>
                        </div>
                        <button class="btn btn-warning" style="padding: 8px 16px;" onclick="addStock(${material.id})">
                            ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å
                        </button>
                    </div>
                `).join('');
                listDiv.innerHTML = html;
            } else {
                alertDiv.style.display = 'none';
            }
        }

        function renderProducts() {
            const html = products.map(product => {
                const stockStatus = product.stock <= 10 ? 'status-low' : product.stock <= 20 ? 'status-medium' : 'status-good';
                return `
                    <div class="product-card">
                        <div class="product-name">${product.name}</div>
                        <div class="product-category">${product.category}</div>
                        <div class="product-price">‡∏ø${product.price.toLocaleString()}</div>
                        <div class="product-stock">
                            ‡∏™‡∏ï‡πá‡∏≠‡∏Å: <span class="status-badge ${stockStatus}">${product.stock}</span>
                        </div>
                        <div style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">
                            ‡∏Å‡∏≥‡πÑ‡∏£: ‡∏ø${(product.price - product.cost).toLocaleString()}/‡πÅ‡∏Å‡πâ‡∏ß
                        </div>
                        <button class="btn btn-primary" onclick="addToCart(${product.id})" 
                                ${product.stock === 0 ? 'disabled' : ''}>
                            üõí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                        </button>
                    </div>
                `;
            }).join('');

            document.getElementById('productsList').innerHTML = html;
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.stock === 0) return;

            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity += 1;
                } else {
                    showAlert('‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠!', 'error');
                    return;
                }
            } else {
                cart.push({ ...product, quantity: 1 });
            }

            updateCartDisplay();
        }

        function updateCartQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            const product = products.find(p => p.id === productId);

            if (!item || !product) return;

            const newQuantity = item.quantity + change;

            if (newQuantity <= 0) {
                cart = cart.filter(item => item.id !== productId);
            } else if (newQuantity <= product.stock) {
                item.quantity = newQuantity;
            } else {
                showAlert('‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠!', 'error');
                return;
            }

            updateCartDisplay();
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartDisplay();
        }

        function updateCartDisplay() {
            const cartContainer = document.getElementById('cartItems');
            const cartSummary = document.getElementById('cartSummary');

            if (cart.length === 0) {
                cartContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üõí</div>
                        <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
                    </div>
                `;
                cartSummary.style.display = 'none';
                return;
            }

            const html = cart.map(item => `
                <div class="cart-item">
                    <div>
                        <div style="font-weight: 600; margin-bottom: 5px;">${item.name}</div>
                        <div style="color: #666; font-size: 0.9rem;">‡∏ø${item.price.toLocaleString()} √ó ${item.quantity} = ‡∏ø${(item.price * item.quantity).toLocaleString()}</div>
                    </div>
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="updateCartQuantity(${item.id}, -1)">-</button>
                        <span style="margin: 0 10px; font-weight: 600;">${item.quantity}</span>
                        <button class="quantity-btn" onclick="updateCartQuantity(${item.id}, 1)">+</button>
                        <button class="btn btn-danger" style="margin-left: 10px; padding: 8px 12px; font-size: 0.9rem;" onclick="removeFromCart(${item.id})">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');

            cartContainer.innerHTML = html;

            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const profit = cart.reduce((sum, item) => sum + ((item.price - item.cost) * item.quantity), 0);

            document.getElementById('cartTotal').textContent = '‡∏ø' + total.toLocaleString();
            document.getElementById('cartProfit').textContent = '‡∏ø' + profit.toLocaleString();
            cartSummary.style.display = 'block';
        }

        async function processSale() {
            if (cart.length === 0) {
                showAlert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤', 'error');
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const timestamp = new Date().toISOString();

            // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            const saleData = cart.map((item, index) => ({
                id: Date.now() + index,
                date: today,
                timestamp: timestamp,
                productId: item.id,
                productName: item.name,
                quantity: item.quantity,
                price: item.price,
                cost: item.cost,
                revenue: item.price * item.quantity,
                profit: (item.price - item.cost) * item.quantity
            }));

            try {
                // ‡πÅ‡∏™‡∏î‡∏á loading
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '<span class="loading"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
                button.disabled = true;

                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets
                const success = await saveToGoogleSheets(saleData);

                if (success) {
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô localStorage (‡∏™‡∏≥‡∏£‡∏≠‡∏á)
                    sales.push(...saleData);

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                    cart.forEach(cartItem => {
                        const product = products.find(p => p.id === cartItem.id);
                        if (product) {
                            product.stock -= cartItem.quantity;
                        }
                    });

                    saveData();

                    // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                    cart = [];
                    updateCartDisplay();

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
                    renderProducts();
                    updateDashboard();
                    updateRecentSales();

                    showAlert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡πÅ‡∏•‡πâ‡∏ß', 'success');
                } else {
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡πÑ‡∏î‡πâ');
                }

                // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°
                button.innerHTML = originalText;
                button.disabled = false;

            } catch (error) {
                console.error('Error processing sale:', error);
                showAlert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');

                // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°
                const button = event.target;
                button.innerHTML = 'üí≥ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢';
                button.disabled = false;
            }
        }

        function updateRecentSales() {
            const recent = sales.slice(-10).reverse(); // ‡πÅ‡∏™‡∏î‡∏á 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤
            const container = document.getElementById('recentSales');

            if (recent.length === 0) {
                container.innerHTML = `
            <div class="empty-state">
                <div class="icon">üìù</div>
                <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</p>
            </div>
        `;
                return;
            }

            const html = `
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤</th>
                        <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                        <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                        <th>‡∏£‡∏ß‡∏°</th>
                        <th>‡∏Å‡∏≥‡πÑ‡∏£</th>
                        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th> <!-- ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö -->
                    </tr>
                </thead>
                <tbody>
                    ${recent.map(sale => `
                        <tr>
                            <td>${new Date(sale.timestamp || sale.date).toLocaleString('th-TH')}</td>
                            <td style="font-weight: 600;">${sale.productName}</td>
                            <td style="text-align: center;">${sale.quantity}</td>
                            <td style="text-align: right;">‡∏ø${sale.price.toLocaleString()}</td>
                            <td style="text-align: right;">‡∏ø${(sale.price * sale.quantity).toLocaleString()}</td>
                            <td style="text-align: right; color: #28a745;">‡∏ø${((sale.price - sale.cost) * sale.quantity).toLocaleString()}</td>
                            <td style="text-align: center;">
                                <button class="btn-delete" onclick="deleteSale(${sale.id})" title="‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ">
                                    <i class="fas fa-trash-alt"></i> ‡∏•‡∏ö
                                </button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    `;
            container.innerHTML = html;
        }

        async function deleteSale(saleId) {
            // ‡πÉ‡∏ä‡πâ SweetAlert2 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö
            const { isConfirmed } = await Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£',
                text: '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ô‡∏µ‡πâ?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            });

            if (!isConfirmed) return;

            try {
                // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö
                const index = sales.findIndex(sale => sale.id === saleId);
                if (index !== -1) {
                    // ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                    const deletedSale = sales[index];
                    const product = products.find(p => p.id === deletedSale.productId);
                    if (product) {
                        product.stock += deletedSale.quantity;
                    }

                    // ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏≠‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏¢‡πå
                    sales.splice(index, 1);

                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
                    saveData();

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
                    updateRecentSales();
                    updateDashboard();
                    renderProducts();

                    // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    await Swal.fire({
                        title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: '‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });
                }
            } catch (error) {
                console.error('Error deleting sale:', error);
                Swal.fire({
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ',
                    icon: 'error'
                });
            }
        }

        function renderProductsTable() {
            const html = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                            <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</th>
                            <th>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</th>
                            <th>‡∏Å‡∏≥‡πÑ‡∏£/‡πÅ‡∏Å‡πâ‡∏ß</th>
                            <th>‡∏™‡∏ï‡πá‡∏≠‡∏Å</th>
                            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${products.map(product => {
                const stockStatus = product.stock <= 10 ? 'status-low' : product.stock <= 20 ? 'status-medium' : 'status-good';
                return `
                                <tr>
                                    <td style="font-weight: 600;">${product.name}</td>
                                    <td>${product.category}</td>
                                    <td style="text-align: right;">‡∏ø${product.price.toLocaleString()}</td>
                                    <td style="text-align: right;">‡∏ø${product.cost.toLocaleString()}</td>
                                    <td style="text-align: right; color: #28a745; font-weight: 600;">‡∏ø${(product.price - product.cost).toLocaleString()}</td>
                                    <td style="text-align: center;">
                                        <span class="status-badge ${stockStatus}">
                                            ${product.stock}
                                        </span>
                                    </td>
                                    <td style="text-align: center;">
                                        <button class="btn btn-primary" style="padding: 8px 16px; margin-right: 8px; font-size: 0.9rem;" onclick="editProduct(${product.id})">
                                            ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                        </button>
                                        <button class="btn btn-danger" style="padding: 8px 16px; font-size: 0.9rem;" onclick="deleteProduct(${product.id})">
                                            üóëÔ∏è ‡∏•‡∏ö
                                        </button>
                                    </td>
                                </tr>
                            `;
            }).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('productsTable').innerHTML = html;
        }

        function renderMaterialsTable() {
            const html = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</th>
                            <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                            <th>‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th>
                            <th>‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥</th>
                            <th>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${materials.map(material => {
                const isLow = material.stock <= material.minStock;
                return `
                                <tr>
                                    <td style="font-weight: 600;">${material.name}</td>
                                    <td>${material.unit}</td>
                                    <td style="text-align: center; font-weight: 600;">${material.stock}</td>
                                    <td style="text-align: center;">${material.minStock}</td>
                                    <td style="text-align: right;">‡∏ø${material.cost.toLocaleString()}</td>
                                    <td style="text-align: center;">
                                        <span class="status-badge ${isLow ? 'status-low' : 'status-good'}">
                                            ${isLow ? '‚ö†Ô∏è ‡∏ï‡πà‡∏≥' : '‚úÖ ‡∏õ‡∏Å‡∏ï‡∏¥'}
                                        </span>
                                    </td>
                                    <td style="text-align: center;">
                                        <button class="btn btn-success" style="padding: 8px 12px; margin-right: 5px; font-size: 0.9rem;" onclick="addStock(${material.id})">
                                            ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°
                                        </button>
                                        <button class="btn btn-primary" style="padding: 8px 12px; margin-right: 5px; font-size: 0.9rem;" onclick="editMaterial(${material.id})">
                                            ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                        </button>
                                        <button class="btn btn-danger" style="padding: 8px 12px; font-size: 0.9rem;" onclick="deleteMaterial(${material.id})">
                                            üóëÔ∏è ‡∏•‡∏ö
                                        </button>
                                    </td>
                                </tr>
                            `;
            }).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('materialsTable').innerHTML = html;
        }

        function updateReports() {
            const totalRevenue = sales.reduce((sum, sale) => sum + (sale.quantity * sale.price), 0);
            const totalProfit = sales.reduce((sum, sale) => sum + (sale.quantity * (sale.price - sale.cost)), 0);
            const totalQuantity = sales.reduce((sum, sale) => sum + sale.quantity, 0);
            const profitMargin = totalRevenue > 0 ? ((totalProfit / totalRevenue) * 100).toFixed(1) : 0;

            document.getElementById('totalRevenue').textContent = '‡∏ø' + totalRevenue.toLocaleString();
            document.getElementById('totalProfit').textContent = '‡∏ø' + totalProfit.toLocaleString();
            document.getElementById('totalQuantity').textContent = totalQuantity.toLocaleString();
            document.getElementById('profitMargin').textContent = profitMargin + '%';

            updateProductReports();
        }

        function updateProductReports() {
            const productStats = {};

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            sales.forEach(sale => {
                if (!productStats[sale.productName]) {
                    productStats[sale.productName] = {
                        name: sale.productName,
                        totalQuantity: 0,
                        totalRevenue: 0,
                        totalProfit: 0
                    };
                }
                productStats[sale.productName].totalQuantity += sale.quantity;
                productStats[sale.productName].totalRevenue += sale.quantity * sale.price;
                productStats[sale.productName].totalProfit += sale.quantity * (sale.price - sale.cost);
            });

            const productReportData = Object.values(productStats)
                .sort((a, b) => b.totalRevenue - a.totalRevenue);

            if (productReportData.length === 0) {
                document.getElementById('productReports').innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üìä</div>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</p>
                    </div>
                `;
                return;
            }

            const html = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏≤‡∏¢</th>
                            <th>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</th>
                            <th>‡∏Å‡∏≥‡πÑ‡∏£</th>
                            <th>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${productReportData.map(product => {
                const profitRate = product.totalRevenue > 0 ? ((product.totalProfit / product.totalRevenue) * 100).toFixed(1) : 0;
                return `
                                <tr>
                                    <td style="font-weight: 600;">${product.name}</td>
                                    <td style="text-align: center; font-weight: 600;">${product.totalQuantity}</td>
                                    <td style="text-align: right; font-weight: 600;">‡∏ø${product.totalRevenue.toLocaleString()}</td>
                                    <td style="text-align: right; color: #28a745; font-weight: 600;">‡∏ø${product.totalProfit.toLocaleString()}</td>
                                    <td style="text-align: right; font-weight: 600;">${profitRate}%</td>
                                </tr>
                            `;
            }).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('productReports').innerHTML = html;
        }

        // Modal functions
        function showAddProductModal() {
            document.getElementById('addProductModal').style.display = 'block';
        }

        function showAddMaterialModal() {
            document.getElementById('addMaterialModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        async function addProduct(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);

            try {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                const name = formData.get('name').trim();
                const price = parseFloat(formData.get('price'));
                const cost = parseFloat(formData.get('cost'));
                const stock = parseInt(formData.get('stock'));
                const category = formData.get('category').trim();

                if (!name || isNaN(price) || isNaN(cost) || isNaN(stock)) {
                    throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                }

                if (price <= 0 || cost <= 0 || stock < 0) {
                    throw new Error('‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ö‡∏ß‡∏Å');
                }

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡πÉ‡∏´‡∏°‡πà
                const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á object ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
                const newProduct = {
                    id: newId,
                    name,
                    price,
                    cost,
                    stock,
                    category
                };

                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
                products.push(newProduct);

                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                saveData();

                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
                updateAllProductViews();

                // ‡∏õ‡∏¥‡∏î modal ‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
                closeModal('addProductModal');
                form.reset();

                // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                await Swal.fire({
                    title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
                    icon: 'success',
                    timer: 1500,
                    showConfirmButton: false
                });

            } catch (error) {
                // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
                await Swal.fire({
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: error.message,
                    icon: 'error',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                });
                console.error('Error adding product:', error);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ó‡∏∏‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function updateAllProductViews() {
            renderProducts();      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢
            renderProductsTable(); // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            updateDashboard();     // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)

            // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó)
            window.dispatchEvent(new CustomEvent('products-updated'));
        }
        function addMaterial(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const newMaterial = {
                id: Math.max(...materials.map(m => m.id), 0) + 1,
                name: formData.get('name'),
                unit: formData.get('unit'),
                stock: parseInt(formData.get('stock')),
                cost: parseFloat(formData.get('cost')),
                minStock: parseInt(formData.get('minStock'))
            };

            materials.push(newMaterial);
            saveData();
            renderMaterialsTable();
            updateLowStockAlert();
            closeModal('addMaterialModal');
            event.target.reset();
            showAlert('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!', 'success');
        }

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;

            const form = document.getElementById('editProductForm');
            form.elements.id.value = product.id;
            form.elements.name.value = product.name;
            form.elements.price.value = product.price;
            form.elements.cost.value = product.cost;
            form.elements.stock.value = product.stock;
            form.elements.category.value = product.category;

            document.getElementById('editProductModal').style.display = 'block';
        }

        function updateProduct(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const id = parseInt(formData.get('id'));

            const productIndex = products.findIndex(p => p.id === id);
            if (productIndex === -1) return;

            products[productIndex] = {
                id: id,
                name: formData.get('name'),
                price: parseFloat(formData.get('price')),
                cost: parseFloat(formData.get('cost')),
                stock: parseInt(formData.get('stock')),
                category: formData.get('category')
            };

            saveData();
            renderProducts();
            renderProductsTable();
            closeModal('editProductModal');
            showAlert('‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!', 'success');
        }

        function deleteProduct(id) {
            Swal.fire({
                title: '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                text: "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢!',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            }).then((result) => {
                if (result.isConfirmed) {
                    products = products.filter(p => p.id !== id);
                    cart = cart.filter(item => item.id !== id);
                    saveData();
                    renderProducts();
                    renderProductsTable();
                    updateCartDisplay();

                    Swal.fire({
                        icon: 'success',
                        title: '‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!',
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
            });
        }


        function deleteMaterial(id) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ô‡∏µ‡πâ?')) {
                materials = materials.filter(m => m.id !== id);
                saveData();
                renderMaterialsTable();
                updateLowStockAlert();
                showAlert('‚úÖ ‡∏•‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!', 'success');
            }
        }

        function addStock(id) {
            const material = materials.find(m => m.id === id);
            if (!material) return;

            Swal.fire({
                title: `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö "${material.name}"`,
                input: 'number',
                inputLabel: '‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°',
                inputAttributes: {
                    min: 1,
                    step: 1
                },
                inputPlaceholder: '‡πÄ‡∏ä‡πà‡∏ô 10',
                showCancelButton: true,
                confirmButtonText: '‡πÄ‡∏û‡∏¥‡πà‡∏°',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                preConfirm: (value) => {
                    if (!value || isNaN(value) || parseInt(value) <= 0) {
                        Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0)');
                    }
                    return value;
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const quantity = parseInt(result.value);
                    material.stock += quantity;
                    saveData();
                    renderMaterialsTable();
                    updateLowStockAlert();

                    Swal.fire({
                        icon: 'success',
                        title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!',
                        text: `‡πÄ‡∏û‡∏¥‡πà‡∏° ${quantity} ‡∏ä‡∏¥‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö "${material.name}"`,
                        showConfirmButton: false,
                        timer: 2000
                    });
                }
            });
        }


        function editMaterial(id) {
            const material = materials.find(m => m.id === id);
            if (!material) return;

            Swal.fire({
                title: `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å "${material.name}"`,
                input: 'number',
                inputLabel: `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${material.stock} ${material.unit}`,
                inputValue: material.stock,
                inputAttributes: {
                    min: 0,
                    step: 1
                },
                showCancelButton: true,
                confirmButtonText: '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                preConfirm: (value) => {
                    if (value === '' || isNaN(value) || parseInt(value) < 0) {
                        Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (0 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ)');
                    }
                    return value;
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const newStock = parseInt(result.value);
                    material.stock = newStock;
                    saveData();
                    renderMaterialsTable();
                    updateLowStockAlert();

                    Swal.fire({
                        icon: 'success',
                        title: '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!',
                        text: `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á "${material.name}" ‡∏Ñ‡∏∑‡∏≠ ${newStock} ${material.unit}`,
                        showConfirmButton: false,
                        timer: 2000
                    });
                }
            });
        }


        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type === 'success' ? 'success' : 'danger'}`;
            alertDiv.innerHTML = message;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.style.minWidth = '350px';
            alertDiv.style.maxWidth = '500px';
            alertDiv.style.boxShadow = '0 15px 35px rgba(0,0,0,0.2)';
            alertDiv.style.animation = 'slideInRight 0.3s ease';

            document.body.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 300);
            }, 4000);
        }

        // Close modals when clicking outside
        window.onclick = function (event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function (event) {
            // Alt + 1-5 for tab switching
            if (event.altKey) {
                switch (event.key) {
                    case '1':
                        event.preventDefault();
                        document.querySelector('[onclick="showTab(\'dashboard\')"]').click();
                        break;
                    case '2':
                        event.preventDefault();
                        document.querySelector('[onclick="showTab(\'sales\')"]').click();
                        break;
                    case '3':
                        event.preventDefault();
                        document.querySelector('[onclick="showTab(\'products\')"]').click();
                        break;
                    case '4':
                        event.preventDefault();
                        document.querySelector('[onclick="showTab(\'materials\')"]').click();
                        break;
                    case '5':
                        event.preventDefault();
                        document.querySelector('[onclick="showTab(\'reports\')"]').click();
                        break;
                }
            }

            // Escape key to close modals
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }
        });

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialize recent sales display after a short delay
        setTimeout(() => {
            updateRecentSales();
        }, 100);
    </script>

</body>

</html>